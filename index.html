<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Cryptography</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
/* Light/Dark Mode Color Variables */
:root {
    /* Dark mode colors (default) */
    --primary-color: #00ff41;
    --bg-color: #000000;
    --secondary-bg: #0a0a0a;
    --border-color: #00ff41;
    --text-color: #00ff41;
    --accent-color: #ff1493;
    --checkbox-size: 18px;
    --checkbox-border: 2px;
    --font-weight-normal: 500;
    --font-weight-bold: 700;
    --base-font-size: 16px;
    --heading-font-size: 2.2em;
    --subheading-font-size: 1.6em;
    --text-font-size: 1.1em;
}

/* Light mode colors */
@media (prefers-color-scheme: light) {
    :root {
        --primary-color: #006400;
        --bg-color: #ffffff;
        --secondary-bg: #f5f5f5;
        --border-color: #006400;
        --text-color: #000000;
        --accent-color: #d81b60;
    }
    
    /* Update title colors for light mode */
    .title span:nth-child(1) { color: #0077cc !important; }
    .title span:nth-child(2) { color: #0066b2 !important; }
    .title span:nth-child(3) { color: #d81b60 !important; }
    .title span:nth-child(4) { color: #c41e3a !important; }
    .title span:nth-child(5) { color: #b22222 !important; }
    .title span:nth-child(6) { color: #8b0000 !important; }
}

/* Base styles */
body {
    font-family: 'Consolas', 'Courier New', monospace;
    margin: 0;
    padding: 20px;
    background-color: var(--bg-color);
    color: var(--text-color);
    font-size: var(--base-font-size);
    font-weight: var(--font-weight-normal);
    line-height: 1.5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 2fr 1fr 2fr;
    gap: 20px;
}

.title {
    text-align: center;
    margin-bottom: 20px;
    font-size: var(--heading-font-size);
    font-weight: var(--font-weight-bold);
}

.title span {
    margin: 0 2px;
}

/* Dark mode title colors (default) */
.title span:nth-child(1) { color: #00ffff; }
.title span:nth-child(2) { color: #00ccff; }
.title span:nth-child(3) { color: #ff3366; }
.title span:nth-child(4) { color: #ff3333; }
.title span:nth-child(5) { color: #ff0000; }
.title span:nth-child(6) { color: #cc0000; }

.input-section, .output-section {
    display: flex;
    flex-direction: column;
}

.input-section h2, .output-section h2 {
    text-align: center;
    margin-bottom: 15px;
}

/* Dark mode specific colors for encrypt/decrypt modes */
@media (prefers-color-scheme: dark) {
    /* Encrypt mode colors */
    body[data-mode="encrypt"] .input-section textarea {
        color: #40E0D0; /* Light turquoise */
    }
    
    body[data-mode="encrypt"] .output-section textarea {
        color: #FF3333; /* Neon red */
    }
    
    /* Decrypt mode colors */
    body[data-mode="decrypt"] .input-section textarea {
        color: #FF3333; /* Neon red */
    }
    
    body[data-mode="decrypt"] .output-section textarea {
        color: #40E0D0; /* Light turquoise */
    }
}

.control-section {
    background-color: var(--secondary-bg);
    padding: 20px;
    border: 1px solid var(--border-color);
}

/* Group Box Styles */
.group-box {
    border: 1px solid var(--border-color);
    padding: 15px;
    margin-bottom: 15px;
    position: relative;
    padding-top: 35px;
    background-color: var(--secondary-bg);
}

.group-box h3 {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    margin: 0;
    background-color: var(--secondary-bg);
    padding: 0 20px;
    display: inline-block;
    color: var(--primary-color);
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-bold);
    letter-spacing: 1px;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    transition: all 0.3s ease;
}

.group-box h3:hover {
    color: var(--accent-color);
    text-shadow: 0 0 5px var(--accent-color);
}

/* Checkbox Container Styles */
.checkbox-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 8px 0;
    padding: 4px 0;
    position: relative;
}

.checkbox-container input[type="checkbox"] {
    opacity: 0;
    position: absolute;
    width: var(--checkbox-size);
    height: var(--checkbox-size);
    margin: 0;
    cursor: pointer;
}

.checkbox-container label {
    position: relative;
    padding-left: calc(var(--checkbox-size) + 10px);
    cursor: pointer;
    display: inline-block;
    text-align: center;
    margin: 0;
    flex: 1;
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-normal);
}

.checkbox-container label::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: var(--checkbox-size);
    height: var(--checkbox-size);
    border: var(--checkbox-border) solid var(--border-color);
    background: var(--secondary-bg);
    box-sizing: border-box;
    transition: all 0.3s ease;
}

.checkbox-container label::after {
    content: '';
    position: absolute;
    left: calc(var(--checkbox-size) / 4);
    top: 50%;
    transform: translateY(-50%) scale(0);
    width: calc(var(--checkbox-size) / 2);
    height: calc(var(--checkbox-size) / 2);
    background: var(--primary-color);
    transition: all 0.2s ease;
    box-shadow: 0 0 5px var(--primary-color);
}

.checkbox-container input[type="checkbox"]:checked + label::before {
    border-color: var(--primary-color);
    box-shadow: 0 0 5px var(--primary-color);
}

.checkbox-container input[type="checkbox"]:checked + label::after {
    transform: translateY(-50%) scale(1);
}

/* Input Styles */
textarea {
    background-color: var(--secondary-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 10px;
    margin-bottom: 10px;
    min-height: 200px;
    resize: vertical;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-normal);
    line-height: 1.5;
}

.key-input, .cipher-input {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 10px 0;
    gap: 15px;
}

.key-input .checkbox-container,
.cipher-input .checkbox-container {
    flex: 1;
    justify-content: flex-start;
}

.key-input input[type="password"],
.cipher-input input[type="text"],
.key-input input[type="text"] {
    width: 150px;
    padding: 8px 12px;
    background-color: var(--secondary-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    outline: none;
    transition: all 0.3s ease;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-normal);
}

/* Button Styles */
button {
    background-color: var(--secondary-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 8px 15px;
    cursor: pointer;
    margin: 5px 0;
    transition: all 0.3s;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-bold);
}

button:hover {
    background-color: var(--primary-color);
    color: var(--bg-color);
    box-shadow: 0 0 10px var(--primary-color);
}

/* Mode Selector Styles */
.mode-selector {
    text-align: center;
    margin-bottom: 20px;
}

select {
    background-color: var(--secondary-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 5px;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: var(--text-font-size);
    font-weight: var(--font-weight-normal);
}

/* Chain Display */
.chain-display {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid var(--border-color);
    min-height: 100px;
    background-color: var(--secondary-bg);
    font-size: var(--text-font-size);
}

/* Toggle Icon */
.toggle-icon {
    position: absolute;
    right: -15px;
    top: 50%;
    transform: translateY(-50%);
    transition: transform 0.3s ease;
    font-size: 0.8em;
    opacity: 0.8;
}

.group-box.collapsed .toggle-icon {
    transform: translateY(-50%) rotate(0deg);
}

.group-box:not(.collapsed) .toggle-icon {
    transform: translateY(-50%) rotate(135deg);
}

/* Section Content */
.section-content {
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    max-height: 1000px;
}

.group-box.collapsed .section-content {
    max-height: 0;
}

/* Counter Styles */
.counter {
    font-size: 0.8em;
    color: var(--text-color);
    margin-left: 10px;
}

/* Config Buttons */
.config-buttons {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 10px;
    gap: 10px;
}

.config-buttons button {
    flex: 1;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.modal-content {
    position: relative;
    background-color: var(--secondary-bg);
    margin: 15% auto;
    padding: 20px;
    border: 1px solid var(--border-color);
    width: 80%;
    max-width: 500px;
}

.modal h2 {
    margin-top: 0;
    color: var(--text-color);
    font-size: var(--subheading-font-size);
    font-weight: var(--font-weight-bold);
}

.modal input {
    width: 100%;
    margin: 10px 0;
    padding: 8px;
    box-sizing: border-box;
    font-size: var(--text-font-size);
}

.modal .error {
    color: var(--accent-color);
    margin: 10px 0;
}

.modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

/* Mode Select Specific Styles */
#mode-select {
    color: inherit;
}

#mode-select option[value="encrypt"] {
    color: #ff0000;
    background-color: var(--secondary-bg);
}

#mode-select option[value="decrypt"] {
    color: #00ffff;
    background-color: var(--secondary-bg);
}

#mode-select.encrypt-mode {
    color: #ff0000;
}

#mode-select.decrypt-mode {
    color: #00ffff;
}

/* Developer Credit */
.developer-credit {
    text-align: center;
    color: var(--text-color);
    font-size: 0.9em;
    margin-top: -15px;
    margin-bottom: 20px;
    opacity: 0.8;
}

/* Focus States */
textarea:focus,
input:focus,
select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 5px var(--primary-color);
    outline: none;
}

/* Accessibility Improvements */
.checkbox-container input[type="checkbox"]:focus + label::before {
    border-color: var(--primary-color);
    box-shadow: 0 0 5px var(--primary-color);
}

button:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Animation and Transitions */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    animation: fadeIn 0.3s ease-out;
}

/* High DPI Screen Optimizations */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    .group-box h3 {
        -webkit-font-smoothing: antialiased;
    }
}

/* Print Styles */
@media print {
    body {
        background: white;
        color: black;
    }

    .control-section,
    .mode-selector,
    button {
        display: none;
    }

    .container {
        display: block;
    }

    textarea {
        border: none;
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
    }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    :root {
        --base-font-size: 18px;
        --heading-font-size: 2.4em;
        --subheading-font-size: 1.8em;
        --text-font-size: 1.2em;
    }

    body {
        padding: 10px;
        line-height: 1.4;
    }

    .container {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .key-input, .cipher-input {
        flex-direction: column;
        align-items: stretch;
    }

    .key-input input[type="password"],
    .cipher-input input[type="text"],
    .key-input input[type="text"] {
        width: 100%;
        margin: 5px 0;
        min-height: 48px;
    }

    .group-box {
        padding: 10px;
        margin-bottom: 10px;
        padding-top: 30px;
    }

    .group-box h3 {
        font-size: 1.2em;
        padding: 0 15px;
    }

    button {
        width: 100%;
        padding: 12px;
        margin: 5px 0;
        min-height: 48px;
    }

    select {
        width: 100%;
        margin-bottom: 10px;
        min-height: 48px;
        font-size: var(--text-font-size);
    }

    .checkbox-container label {
        padding: 12px 0 12px calc(var(--checkbox-size) + 12px);
    }

    /* Adjust spacing for better mobile readability */
    .input-section, .output-section {
        margin-bottom: 20px;
    }

    textarea {
        min-height: 150px;
    }

    .modal-content {
        width: 95%;
        margin: 10% auto;
    }

    /* Adjust checkbox size for mobile */
    :root {
        --checkbox-size: 24px;
        --checkbox-border: 2px;
    }
}
</style>

</head>
<body>
    <div class="title">
        <span>G</span><span>E</span><span>M</span><span>I</span><span>N</span><span>I</span>
    </div>
    <div class="developer-credit">developed by elkmire</div>
    
    <div class="container">
        <div class="input-section">
            <h2>Input <span class="counter" id="input-counter">(0 chars)</span></h2>
            <textarea id="input-text" placeholder="Enter message to encrypt..."></textarea>
            <button id="import-token" style="display: none;">Import Token</button>
        </div>

        <div class="control-section">
            <div class="mode-selector">
                <select id="mode-select">
                    <option value="encrypt" style="color: #ff0000;">Encrypt</option>
                    <option value="decrypt" style="color: #00ffff;">Decrypt</option>
                </select>
                <div class="config-buttons">
                    <button id="load-config">Load Config</button>
                    <p>CHECK MODE</p>
                    <button id="save-config">Save Config</button>
                </div>
            </div>

            <div class="group-box collapsed">
                <h3>Basic <span class="toggle-icon">+</span></h3>
                <div class="section-content">
                    <div class="cipher-input">
                        <div class="checkbox-container">
                            <input type="checkbox" id="caesar-check">
                            <label for="caesar-check">Caesar Cipher</label>
                        </div>
                        <input type="text" id="caesar-shift" placeholder="Shift (default: 3)" value="3">
                    </div>
                    <div class="cipher-input">
                        <div class="checkbox-container">
                            <input type="checkbox" id="vigenere-check">
                            <label for="vigenere-check">Vigenère Cipher</label>
                        </div>
                        <input type="text" id="vigenere-key" placeholder="Key">
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="atbash-check">
                        <label for="atbash-check">Atbash Cipher</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="reverse-check">
                        <label for="reverse-check">Reverse Text</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="morse-check">
                        <label for="morse-check">Morse Code</label>
                    </div>
                </div>
            </div>
            
            <div class="group-box collapsed">
                <h3>Encoding <span class="toggle-icon">+</span></h3>
                <div class="section-content">
                    <div class="checkbox-container">
                        <input type="checkbox" id="base85-check">
                        <label for="base85-check">Base85</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="base64-check">
                        <label for="base64-check">Base64</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="base32-check">
                        <label for="base32-check">Base32</label>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="hex-check">
                        <label for="hex-check">Hexadecimal</label>
                    </div>
                </div>
            </div>
            
            <div class="group-box collapsed">
                <h3>Encryption <span class="toggle-icon">+</span></h3>
                <div class="section-content">
                    <div class="key-input">
                        <div class="checkbox-container">
                            <input type="checkbox" id="aes-check">
                            <label for="aes-check">AES-256</label>
                        </div>
                        <input type="password" id="aes-key" placeholder="AES key">
                    </div>
                    <div class="key-input">
                        <div class="checkbox-container">
                            <input type="checkbox" id="chacha-check">
                            <label for="chacha-check">ChaCha20-Poly1305</label>
                        </div>
                        <input type="password" id="chacha-key" placeholder="ChaCha key">
                    </div>
                </div>
            </div>

            <button id="reset-button">Reset</button>

            <div class="chain-display" id="chain-display">
                <p>Chain will appear here...</p>
            </div>
        </div>

        <div class="output-section">
            <h2>Output <span class="counter" id="output-counter">(0 chars)</span></h2>
            <textarea id="output-text" readonly placeholder="Encrypted message will appear here..."></textarea>
            <div>
                <button id="copy-button">Copy Message</button>
                <button id="create-token" style="display: none;">Create Token</button>
            </div>
        </div>
    </div>

    <div id="save-modal" class="modal">
        <div class="modal-content">
            <h2>Save Configuration</h2>
            <p>Enter a password to encrypt your configuration</p>
            <input type="password" id="save-password" placeholder="Enter password">
            <div id="save-error" class="error"></div>
            <div class="modal-buttons">
                <button id="save-cancel">Cancel</button>
                <button id="save-confirm">Save</button>
            </div>
        </div>
    </div>
    
    <div id="load-modal" class="modal">
        <div class="modal-content">
            <h2>Load Configuration</h2>
            <p>Select a configuration file and enter the password</p>
            <input type="password" id="load-password" placeholder="Enter password">
            <input type="file" id="config-file" accept=".txt">
            <div id="load-error" class="error"></div>
            <div class="modal-buttons">
                <button id="load-cancel">Cancel</button>
                <button id="load-confirm">Load</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize all UI elements
        const elements = {
            inputText: document.getElementById('input-text'),
            outputText: document.getElementById('output-text'),
            modeSelect: document.getElementById('mode-select'),
            chainDisplay: document.getElementById('chain-display'),
            inputCounter: document.getElementById('input-counter'),
            outputCounter: document.getElementById('output-counter'),
            copyButton: document.getElementById('copy-button'),
            resetButton: document.getElementById('reset-button')
        };

        // Initialize encryption methods
        const encryptionMethods = {
            caesar: document.getElementById('caesar-check'),
            caesarShift: document.getElementById('caesar-shift'),
            vigenere: document.getElementById('vigenere-check'),
            vigenereKey: document.getElementById('vigenere-key'),
            atbash: document.getElementById('atbash-check'),
            reverse: document.getElementById('reverse-check'),
            morse: document.getElementById('morse-check'),
            base85: document.getElementById('base85-check'),
            base64: document.getElementById('base64-check'),
            base32: document.getElementById('base32-check'),
            hex: document.getElementById('hex-check'),
            aes: document.getElementById('aes-check'),
            aesKey: document.getElementById('aes-key'),
            chacha: document.getElementById('chacha-check'),
            chachaKey: document.getElementById('chacha-key')
        };

        const createTokenButton = document.getElementById('create-token');
        const importTokenButton = document.getElementById('import-token');



        // Morse code lookup table
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---',
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...',
            '8': '---..', '9': '----.'
        };

// Event listeners
elements.inputText.addEventListener('input', updateOutput);
elements.modeSelect.addEventListener('change', updateMode);
elements.copyButton.addEventListener('click', copyToClipboard);
elements.resetButton.addEventListener('click', resetState);

// Add event listeners for all encryption method checkboxes
Object.values(encryptionMethods).forEach(element => {
    if (element) {
        element.addEventListener('change', updateOutput);
        if (element.type === 'text' || element.type === 'password') {
            element.addEventListener('input', updateOutput);
        }
    }
});

// Add this line here, after the event listeners are initialized
document.body.setAttribute('data-mode', elements.modeSelect.value);

function updateTokenButtons() {
    const isEncrypt = elements.modeSelect.value === 'encrypt';
    createTokenButton.style.display = isEncrypt ? 'inline-block' : 'none';
    importTokenButton.style.display = isEncrypt ? 'none' : 'inline-block';
}

function updateMode() {
    const isEncrypt = elements.modeSelect.value === 'encrypt';
    elements.modeSelect.className = isEncrypt ? 'encrypt-mode' : 'decrypt-mode';
    document.body.setAttribute('data-mode', elements.modeSelect.value); // Add this line
    elements.inputText.placeholder = isEncrypt ? "Enter message to encrypt..." : "Enter message to decrypt...";
    elements.outputText.placeholder = isEncrypt ? "Encrypted message will appear here..." : "Decrypted message will appear here...";
    elements.chainDisplay.innerHTML = isEncrypt ? "Encryption chain will appear here..." : "Decryption chain will appear here...";
    elements.copyButton.textContent = isEncrypt ? "Copy Encrypted Message" : "Copy Decrypted Message";
    updateTokenButtons();
    updateOutput();
}

// Create Token functionality
createTokenButton.addEventListener('click', () => {
    const output = elements.outputText.value;
    if (!output) {
        alert('No encrypted message to save');
        return;
    }
    
    const blob = new Blob([output], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'GToken.txt';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
});

// Import Token functionality
importTokenButton.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.txt';
    
    input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            elements.inputText.value = e.target.result;
            updateOutput();
        };
        reader.readAsText(file);
    };
    
    input.click();
});

// Basic encryption methods
function caesarCipher(text, shift, decrypt = false) {
    shift = parseInt(shift) || 3;
    if (decrypt) shift = 26 - shift;
    return text.replace(/[a-zA-Z]/g, char => {
        const code = char.charCodeAt(0);
        const isUpperCase = char === char.toUpperCase();
        const base = isUpperCase ? 65 : 97;
        return String.fromCharCode(((code - base + shift) % 26) + base);
    });
}

function vigenereCipher(text, key, decrypt = false) {
    if (!key) return text;
    key = key.toUpperCase().replace(/[^A-Z]/g, '');
    if (!key) return text;
    let result = '';
    let keyIndex = 0;
    
    for (let i = 0; i < text.length; i++) {
        if (text[i].match(/[a-zA-Z]/)) {
            const isUpperCase = text[i] === text[i].toUpperCase();
            const charCode = text[i].toUpperCase().charCodeAt(0) - 65;
            const keyChar = key[keyIndex % key.length].charCodeAt(0) - 65;
            let newChar = decrypt 
                ? (charCode - keyChar + 26) % 26
                : (charCode + keyChar) % 26;
            newChar += 65;
            result += isUpperCase 
                ? String.fromCharCode(newChar)
                : String.fromCharCode(newChar).toLowerCase();
            keyIndex++;
        } else {
            result += text[i];
        }
    }
    return result;
}

function atbashCipher(text) {
    return text.replace(/[a-zA-Z]/g, char => {
        const isUpperCase = char === char.toUpperCase();
        const base = isUpperCase ? 65 : 97;
        const newChar = 25 - (char.toUpperCase().charCodeAt(0) - 65) + 65;
        return isUpperCase ? String.fromCharCode(newChar) : String.fromCharCode(newChar).toLowerCase();
    });
}

function reverseText(text) {
    return text.split('').reverse().join('');
}

function morseEncode(text) {
    return text.toUpperCase().split('').map(char => {
        if (char === ' ') return '  ';
        return morseCode[char] || char;
    }).join(' ');
}

function morseDecode(text) {
    const reverseMorse = Object.fromEntries(
        Object.entries(morseCode).map(([key, value]) => [value, key])
    );
    return text.split('  ').map(word => 
        word.split(' ').map(char => 
            reverseMorse[char] || char
        ).join('')
    ).join(' ').toLowerCase();
}

// Encoding methods
function base85Encode(text) {
    // This is a simplified Base85 implementation
    const bytes = new TextEncoder().encode(text);
    return btoa(String.fromCharCode(...bytes));
}

function base85Decode(text) {
    try {
        const decoded = atob(text);
        return new TextDecoder().decode(new Uint8Array([...decoded].map(c => c.charCodeAt(0))));
    } catch (e) {
        throw new Error('Invalid Base85 encoding');
    }
}

function base64Encode(text) {
    return btoa(text);
}

function base64Decode(text) {
    try {
        return atob(text);
    } catch (e) {
        throw new Error('Invalid Base64 encoding');
    }
}

function base32Encode(text) {
    // Simplified Base32 implementation
    return btoa(text).replace(/=/g, '');
}

function base32Decode(text) {
    try {
        return atob(text.padEnd(text.length + (text.length % 8), '='));
    } catch (e) {
        throw new Error('Invalid Base32 encoding');
    }
}

function hexEncode(text) {
    return [...text].map(char => char.charCodeAt(0).toString(16).padStart(2, '0')).join('');
}

function hexDecode(text) {
    try {
        return text.match(/.{1,2}/g).map(byte => String.fromCharCode(parseInt(byte, 16))).join('');
    } catch (e) {
        throw new Error('Invalid hexadecimal encoding');
    }
}

// Advanced encryption methods
async function aesEncrypt(text, password) {
    if (!password) throw new Error('AES password required');
    const salt = CryptoJS.lib.WordArray.random(128/8);
    const key = CryptoJS.PBKDF2(password, salt, {
        keySize: 256/32,
        iterations: 1000
    });
    const iv = CryptoJS.lib.WordArray.random(128/8);
    const encrypted = CryptoJS.AES.encrypt(text, key, { 
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
    });
    return salt.toString() + iv.toString() + encrypted.toString();
}

async function aesDecrypt(text, password) {
    if (!password) throw new Error('AES password required');
    try {
        const salt = CryptoJS.enc.Hex.parse(text.substr(0, 32));
        const iv = CryptoJS.enc.Hex.parse(text.substr(32, 32));
        const encrypted = text.substring(64);
        const key = CryptoJS.PBKDF2(password, salt, {
            keySize: 256/32,
            iterations: 1000
        });
        const decrypted = CryptoJS.AES.decrypt(encrypted, key, { 
            iv: iv,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
        });
        return decrypted.toString(CryptoJS.enc.Utf8);
    } catch (e) {
        throw new Error('AES decryption failed');
    }
}

async function chachaEncrypt(text, password) {
    // Note: This is a simplified version since ChaCha20-Poly1305 isn't directly available in CryptoJS
    if (!password) throw new Error('ChaCha password required');
    return aesEncrypt(text, password); // Fallback to AES for demo
}

async function chachaDecrypt(text, password) {
    if (!password) throw new Error('ChaCha password required');
    return aesDecrypt(text, password); // Fallback to AES for demo
}

// Main encryption/decryption chain
async function updateOutput() {
    let text = elements.inputText.value;
    if (!text) {
        elements.outputText.value = '';
        elements.chainDisplay.innerHTML = '';
        updateCounters();
        return;
    }

const isEncrypt = elements.modeSelect.value === 'encrypt';
const chain = [];

try {
    if (isEncrypt) {
        // Basic encryption methods
        if (encryptionMethods.caesar.checked) {
            const shift = encryptionMethods.caesarShift.value || '3';
            text = caesarCipher(text, shift);
            chain.push(`Caesar Cipher (shift=${shift})`);
        }

        if (encryptionMethods.vigenere.checked) {
            const key = encryptionMethods.vigenereKey.value;
            if (!key) throw new Error('Vigenère key required');
            text = vigenereCipher(text, key);
            chain.push(`Vigenère Cipher (key=${key})`);
        }

        if (encryptionMethods.atbash.checked) {
            text = atbashCipher(text);
            chain.push('Atbash Cipher');
        }

        if (encryptionMethods.reverse.checked) {
            text = reverseText(text);
            chain.push('Text Reversal');
        }

        if (encryptionMethods.morse.checked) {
            text = morseEncode(text);
            chain.push('Morse Code');
        }

        // Advanced encryption
        if (encryptionMethods.aes.checked) {
            text = await aesEncrypt(text, encryptionMethods.aesKey.value);
            chain.push('AES-256 Encryption');
        }

        if (encryptionMethods.chacha.checked) {
            text = await chachaEncrypt(text, encryptionMethods.chachaKey.value);
            chain.push('ChaCha20-Poly1305 Encryption');
        }

        // Encoding methods
        if (encryptionMethods.base85.checked) {
            text = base85Encode(text);
            chain.push('Base85 Encoding');
        }

        if (encryptionMethods.base64.checked) {
            text = base64Encode(text);
            chain.push('Base64 Encoding');
        }

        if (encryptionMethods.base32.checked) {
            text = base32Encode(text);
            chain.push('Base32 Encoding');
        }

        if (encryptionMethods.hex.checked) {
            text = hexEncode(text);
            chain.push('Hexadecimal Encoding');
        }
    } else {
        // Decryption in reverse order
        if (encryptionMethods.hex.checked) {
            text = hexDecode(text);
            chain.push('Hexadecimal Decoding');
        }

        if (encryptionMethods.base32.checked) {
            text = base32Decode(text);
            chain.push('Base32 Decoding');
        }

        if (encryptionMethods.base64.checked) {
            text = base64Decode(text);
            chain.push('Base64 Decoding');
        }

        if (encryptionMethods.base85.checked) {
            text = base85Decode(text);
            chain.push('Base85 Decoding');
        }

        if (encryptionMethods.chacha.checked) {
            text = await chachaDecrypt(text, encryptionMethods.chachaKey.value);
            chain.push('ChaCha20-Poly1305 Decryption');
        }

        if (encryptionMethods.aes.checked) {
            text = await aesDecrypt(text, encryptionMethods.aesKey.value);
            chain.push('AES-256 Decryption');
        }

        if (encryptionMethods.morse.checked) {
            text = morseDecode(text);
            chain.push('Morse Code');
        }

        if (encryptionMethods.reverse.checked) {
            text = reverseText(text);
            chain.push('Text Reversal');
        }

        if (encryptionMethods.atbash.checked) {
            text = atbashCipher(text);
            chain.push('Atbash Cipher');
        }

        if (encryptionMethods.vigenere.checked) {
            const key = encryptionMethods.vigenereKey.value;
            if (!key) throw new Error('Vigenère key required');
            text = vigenereCipher(text, key, true);
            chain.push(`Vigenère Cipher (key=${key})`);
        }

        if (encryptionMethods.caesar.checked) {
            const shift = encryptionMethods.caesarShift.value || '3';
            text = caesarCipher(text, shift, true);
            chain.push(`Caesar Cipher (shift=${shift})`);
        }
    }

    elements.outputText.value = text;

    // Update chain display
    if (chain.length > 0) {
        const chainText = `${isEncrypt ? 'Encryption' : 'Decryption'} Steps:\n` +
            chain.map((step, i) => `${i + 1}. ${step}`).join('\n');
        elements.chainDisplay.innerHTML = chainText;
    } else {
        elements.chainDisplay.innerHTML = `No ${isEncrypt ? 'encryption' : 'decryption'} applied`;
    }
} catch (e) {
    elements.outputText.value = `Error: ${e.message}`;
    elements.chainDisplay.innerHTML = `Error occurred during ${isEncrypt ? 'encryption' : 'decryption'}`;
}

updateCounters();
}

function updateCounters() {
    elements.inputCounter.textContent = `(${elements.inputText.value.length} chars)`;
    elements.outputCounter.textContent = `(${elements.outputText.value.length} chars)`;
}

function copyToClipboard() {
    elements.outputText.select();
    document.execCommand('copy');
}

function resetState() {
    // Reset all form elements
    elements.inputText.value = '';
    elements.outputText.value = '';
    elements.chainDisplay.innerHTML = 'Chain will appear here...';
    elements.modeSelect.value = 'encrypt';

// Reset all checkboxes and inputs
Object.values(encryptionMethods).forEach(element => {
    if (element) {
        if (element.type === 'checkbox') {
            element.checked = false;
        } else if (element.type === 'text' || element.type === 'password') {
            element.value = element.id === 'caesar-shift' ? '3' : '';
        }
    }
});

// Update counters and mode
    updateCounters();
    updateMode();
}

// Configuration management functions
function getCurrentConfig() {
    return {
        caesar: {
            enabled: encryptionMethods.caesar.checked,
            shift: encryptionMethods.caesarShift.value
        },
        vigenere: {
            enabled: encryptionMethods.vigenere.checked,
            key: encryptionMethods.vigenereKey.value
        },
        atbash: encryptionMethods.atbash.checked,
        reverse: encryptionMethods.reverse.checked,
        morse: encryptionMethods.morse.checked,
        base85: encryptionMethods.base85.checked,
        base64: encryptionMethods.base64.checked,
        base32: encryptionMethods.base32.checked,
        hex: encryptionMethods.hex.checked,
        aes: {
            enabled: encryptionMethods.aes.checked,
            key: encryptionMethods.aesKey.value
        },
        chacha: {
            enabled: encryptionMethods.chacha.checked,
            key: encryptionMethods.chachaKey.value
        }
    };
}

function applyConfig(config) {
   
    encryptionMethods.caesar.checked = config.caesar.enabled;
    encryptionMethods.caesarShift.value = config.caesar.shift;
    
    encryptionMethods.vigenere.checked = config.vigenere.enabled;
    encryptionMethods.vigenereKey.value = config.vigenere.key;
    
    encryptionMethods.atbash.checked = config.atbash;
    encryptionMethods.reverse.checked = config.reverse;
    encryptionMethods.morse.checked = config.morse;
    encryptionMethods.base85.checked = config.base85;
    encryptionMethods.base64.checked = config.base64;
    encryptionMethods.base32.checked = config.base32;
    encryptionMethods.hex.checked = config.hex;
    
    encryptionMethods.aes.checked = config.aes.enabled;
    encryptionMethods.aesKey.value = config.aes.key;
    
    encryptionMethods.chacha.checked = config.chacha.enabled;
    encryptionMethods.chachaKey.value = config.chacha.key;

    elements.modeSelect.dispatchEvent(new Event('change'));
}

async function encryptConfig(config, password) {
    const text = JSON.stringify(config);
    const salt = CryptoJS.lib.WordArray.random(128/8);
    const key = CryptoJS.PBKDF2(password, salt, {
        keySize: 256/32,
        iterations: 1000
    });
    const iv = CryptoJS.lib.WordArray.random(128/8);
    const encrypted = CryptoJS.AES.encrypt(text, key, { 
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
    });
    return salt.toString() + iv.toString() + encrypted.toString();
}

async function decryptConfig(encryptedText, password) {
    try {
        const salt = CryptoJS.enc.Hex.parse(encryptedText.substr(0, 32));
        const iv = CryptoJS.enc.Hex.parse(encryptedText.substr(32, 32));
        const encrypted = encryptedText.substring(64);
        const key = CryptoJS.PBKDF2(password, salt, {
            keySize: 256/32,
            iterations: 1000
        });
        const decrypted = CryptoJS.AES.decrypt(encrypted, key, { 
            iv: iv,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
        });
        return JSON.parse(decrypted.toString(CryptoJS.enc.Utf8));
    } catch (e) {
        throw new Error('Invalid password or corrupted configuration file');
    }
}

// Modal management
const saveModal = document.getElementById('save-modal');
const loadModal = document.getElementById('load-modal');
const savePassword = document.getElementById('save-password');
const loadPassword = document.getElementById('load-password');
const configFile = document.getElementById('config-file');
const saveError = document.getElementById('save-error');
const loadError = document.getElementById('load-error');

document.getElementById('save-config').addEventListener('click', () => {
    saveModal.style.display = 'block';
    savePassword.value = '';
    saveError.textContent = '';
});

document.getElementById('load-config').addEventListener('click', () => {
    loadModal.style.display = 'block';
    loadPassword.value = '';
    configFile.value = '';
    loadError.textContent = '';
});

document.getElementById('save-cancel').addEventListener('click', () => {
    saveModal.style.display = 'none';
});

document.getElementById('load-cancel').addEventListener('click', () => {
    loadModal.style.display = 'none';
});

document.getElementById('save-confirm').addEventListener('click', async () => {
    try {
        if (!savePassword.value) {
            saveError.textContent = 'Password is required';
            return;
        }

        const config = getCurrentConfig();
        const encryptedConfig = await encryptConfig(config, savePassword.value);
        
        const blob = new Blob([encryptedConfig], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'GEMINI-KEY.txt';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        saveModal.style.display = 'none';
    } catch (err) {
        saveError.textContent = err.message;
    }
});

document.getElementById('load-confirm').addEventListener('click', async () => {
    try {
        const file = configFile.files[0];
        if (!file) {
            loadError.textContent = 'Please select a file';
            return;
        }
        if (!loadPassword.value) {
            loadError.textContent = 'Password is required';
            return;
        }

        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const encryptedText = e.target.result;
                const config = await decryptConfig(encryptedText, loadPassword.value);
                applyConfig(config);
                loadModal.style.display = 'none';
            } catch (err) {
                loadError.textContent = err.message;
            }
        };
        reader.readAsText(file);
    } catch (err) {
        loadError.textContent = err.message;
    }
});

// Close modals when clicking outside
window.addEventListener('click', (event) => {
    if (event.target === saveModal) {
        saveModal.style.display = 'none';
    }
    if (event.target === loadModal) {
        loadModal.style.display = 'none';
    }
});

function toggleSection(element) {
    element.classList.toggle('collapsed');
    
    // Ensure elements are properly initialized after expanding
    if (!element.classList.contains('collapsed')) {
        updateOutput();
    }
}

// Initialize event listeners for group-box headers
document.querySelectorAll('.group-box h3').forEach(header => {
    header.addEventListener('click', (e) => {
        // Prevent this click from triggering other event listeners
        e.stopPropagation();
        toggleSection(header.parentElement);
    });
});

// Initialize the application
updateMode();

        // Mobile-specific functionality
        if ('ontouchstart' in window) {
            let touchStartY = 0;
            let pullDistance = 0;
            const PULL_THRESHOLD = 60;

            // Pull to refresh
            document.addEventListener('touchstart', (e) => {
                if (document.scrollTop === 0) {
                    touchStartY = e.touches[0].clientY;
                }
            }, { passive: true });

            document.addEventListener('touchmove', (e) => {
                if (touchStartY > 0) {
                    pullDistance = e.touches[0].clientY - touchStartY;
                    if (pullDistance > 0) {
                        document.body.classList.add('refreshing');
                        e.preventDefault();
                    }
                }
            }, { passive: false });

            document.addEventListener('touchend', () => {
                if (pullDistance >= PULL_THRESHOLD) {
                    resetState();
                }
                touchStartY = 0;
                pullDistance = 0;
                document.body.classList.remove('refreshing');
            });

            // Mobile buttons
            document.getElementById('mobile-copy').addEventListener('click', copyToClipboard);
            document.getElementById('mobile-reset').addEventListener('click', resetState);
            document.getElementById('mobile-help').addEventListener('click', () => {
                alert('Gemini Cryptography App\n\n' +
                      'Select encryption methods from the options panel.\n' +
                      'Enter text in the input field and see the results in real-time.\n' +
                      'Use the mode selector to switch between encryption and decryption.');
            });

            // Improve touch response
            document.addEventListener('touchstart', () => {}, {passive: true});

            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd < 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // Handle visibility changes
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                updateOutput();
            }
        });

        // Handle orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(updateLayout, 100);
        });

        function updateLayout() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // Initial layout setup
        updateLayout();
    </script>
</body>
</html>
